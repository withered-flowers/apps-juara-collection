---
import { EVENT_NAME } from "@/utils/google-developer/config";
import Layout from "@/layouts/Layout.astro";
import { InputProfileURL } from "@/utils/google-developer/defs";
import { z } from "astro/zod";

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const profileUrl = data.get("profileUrl");

    const parsedInput = InputProfileURL.safeParse(profileUrl);

    if (!parsedInput.success) {
      throw parsedInput.error;
    }

    console.log(parsedInput.data);

    const response = await fetch(parsedInput.data);
    const responseText = await response.text();

    console.log(responseText.trim());
  } catch (err) {
    if (err instanceof z.ZodError) {
      console.error(err.issues);
    } else if (err instanceof Error) {
      console.error(err.message);
    } else {
      console.error(err);
    }
  }
}
---

<Layout title="Fetch Me">
  <section
    class="flex min-h-[100dvh] w-screen flex-col items-center justify-center gap-2 bg-gray-100 p-4"
  >
    <>
      <p class="text-slate-700">{EVENT_NAME} - URL Validator</p>
      <form class="mb-8 flex flex-row gap-2" method="POST">
        <input
          type="text"
          class="min-w-[25vw] rounded bg-white px-4 py-2 text-slate-700 transition-all duration-300 hover:ring-2 hover:ring-blue-400"
          placeholder="Your Profile URL"
          name="profileUrl"
          required
        />
        <button
          class="mx-auto max-w-[10rem] rounded bg-gray-300 px-4 py-2 transition-colors duration-300 hover:bg-gray-500 hover:text-slate-100"
        >
          Submit
        </button>
      </form>
    </>
  </section>
</Layout>
